#!/usr/bin/env node
var debug = require('debug')('pamm-server');
var app = require('../app');
var mongodb = require('mongodb').MongoClient;

app.set('ipaddress', process.env.OPENSHIFT_NODEJS_IP || "127.0.0.1");
app.set('port', process.env.OPENSHIFT_NODEJS_PORT || 8080);

var mongodburl = (process.env.OPENSHIFT_MONGODB_DB_URL || 'mongodb://localhost/') + 'pamm';

mongodb.connect(mongodburl, function(err, database) {
	if(err) throw err;
	app.set('database', database);
	
	var server = app.listen(app.get('port'), app.get('ipaddress'), function() {
		debug('Express server listening on ' + server.address().address + ':' + server.address().port);
	});
});
